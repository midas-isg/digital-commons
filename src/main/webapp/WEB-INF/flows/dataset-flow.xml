<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">


    <input name="entryID"/>

    <decision-state id="createOrEdit">
        <if test="entryID == null" then="create" else="edit" />
    </decision-state>

    <action-state id="create">
        <evaluate expression="dataset" result="flowScope.dataset" />
        <transition to="datasetForm1">
            <evaluate expression="0" result="flowScope.categoryID"/>
        </transition>
    </action-state>

    <action-state id="edit">
        <evaluate expression="datasetWebflowValidator.editDataset(entryID)" result="flowScope.dataset"/>

        <transition to="datasetForm1">
            <evaluate expression="datasetWebflowValidator.getCategoryId(entryID)" result="flowScope.categoryID"/>
            <evaluate expression="datasetWebflowValidator.getRevisionId(entryID)" result="flowScope.revisionID"/>
        </transition>
    </action-state>

    <action-state id="index">
        <evaluate expression="datasetWebflowValidator.goToIndex(flowScope.indexValue)"/>

        <transition on="identifier" to="datasetForm1"/>
        <transition on="title" to="datasetForm1"/>
        <transition on="description" to="datasetForm1"/>
        <transition on="dates" to="datasetForm1"/>

        <transition on="storedIn" to="datasetForm2"/>

        <transition on="spatialCoverage" to="datasetForm3"/>

        <transition on="types" to="datasetForm4"/>
        <transition on="availability" to="datasetForm4"/>
        <transition on="refinement" to="datasetForm4"/>
        <transition on="aggregation" to="datasetForm4"/>

        <transition on="distributions" to="datasetForm5"/>

        <transition on="primaryPublications" to="datasetForm6"/>

        <transition on="citations" to="datasetForm7"/>
        <transition on="citationCount" to="datasetForm7"/>

        <transition on="producedBy" to="datasetForm8"/>

        <transition on="creators" to="datasetForm9"/>

        <transition on="licenses" to="datasetForm10"/>

        <transition on="isAbout" to="datasetForm11"/>

        <transition on="acknowledges" to="datasetForm12"/>

        <transition on="version" to="datasetForm13"/>
        <transition on="extraProperties" to="datasetForm13"/>
    </action-state>

    <!--           -->
    <!--Form page 1-->
    <view-state id="datasetForm1" model="flowScope.dataset">
        <on-render>
            <set type="java.lang.Long" name="requestScope.categoryID" value="flowScope.categoryID"/>
            <set name="requestScope.categoryPaths" value="datasetWebflowValidator.getCategories()"/>
        </on-render>
        <transition on="next" to="validateForm1">
            <set type="java.lang.Long" name="flowScope.categoryID" value="requestParameters.categoryID"/>
        </transition>

        <transition on="index" to="validateForm1">
            <set type="java.lang.Long" name="flowScope.categoryID" value="requestParameters.categoryID"/>
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>

    </view-state>

    <action-state id="validateForm1">
        <evaluate expression="datasetWebflowValidator.validateDatasetForm1(flowScope.dataset, messageContext, flowScope.categoryID)"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm2"/>
        <transition on="false" to="datasetForm1"/>

    </action-state>
    <!--End form page 1-->
    <!--               -->

    <!-- STORED IN -->
    <!--Form page 2-->
    <view-state id="datasetForm2" model="flowScope.dataset">
        <transition on="previous"  to="datasetForm1"/>
        <transition on="next" to="validateForm2"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm2">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext, 'edu.pitt.isg.mdc.dats2_2.DataRepository', 'getStoredIn', false )"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm3"/>
        <transition on="false" to="datasetForm2"/>

    </action-state>
    <!--End form page 2-->
    <!--               -->

    <!-- SPATIAL COVERAGE -->
    <!--Form page 3-->
    <view-state id="datasetForm3" model="flowScope.dataset">
        <transition on="previous" to="datasetForm2"/>
        <transition on="next" to="validateForm3"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm3">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext,'edu.pitt.isg.mdc.dats2_2.Place', 'getSpatialCoverage', false )"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm4"/>
        <transition on="false" to="datasetForm3"/>
    </action-state>
    <!--End form page 3-->
    <!--               -->

    <!-- Types -->
    <!--Form page 4-->
    <view-state id="datasetForm4" model="flowScope.dataset">
        <transition on="previous" to="datasetForm3"/>
        <transition on="next" to="validateForm4"/>

        <transition on="index" to="validateForm4">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm4">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext,'edu.pitt.isg.mdc.dats2_2.Type', 'getTypes', false )"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm5"/>
        <transition on="false" to="datasetForm4"/>

    </action-state>
    <!--End form page 4-->
    <!--               -->

    <!-- Distributions -->
    <!--Form page 5-->
    <view-state id="datasetForm5" model="flowScope.dataset">
        <transition on="previous" to="datasetForm4"/>
        <transition on="next" to="validateForm5"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm5">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext,'edu.pitt.isg.mdc.dats2_2.Distribution', 'getDistributions', false )"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm6"/>
        <transition on="false" to="datasetForm5"/>
    </action-state>
    <!--End form page 5-->
    <!--               -->

    <!-- Primary Publications -->
    <!--Form page 6-->
    <view-state id="datasetForm6" model="flowScope.dataset">
        <transition on="previous" to="datasetForm5"/>
        <transition on="next" to="validateForm6"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm6">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext,'edu.pitt.isg.mdc.dats2_2.Publication', 'getPrimaryPublications', false )"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm7"/>
        <transition on="false" to="datasetForm6"/>
    </action-state>
    <!--End form page 6-->
    <!--               -->

    <!-- Citations -->
    <!--Form page 7-->
    <view-state id="datasetForm7" model="flowScope.dataset">
        <transition on="previous" to="datasetForm6"/>
        <transition on="next" to="validateForm7"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm7">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext)"/>

        <transition on="true" to="datasetForm8"/>
        <transition on="false" to="datasetForm7"/>
    </action-state>
    <!--End form page 7-->
    <!--               -->

    <!-- Produced By -->
    <!--Form page 8-->
    <view-state id="datasetForm8" model="flowScope.dataset">
        <transition on="previous" to="datasetForm7"/>
        <transition on="next" to="validateForm8"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm8">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext,'edu.pitt.isg.mdc.dats2_2.Study', 'getProducedBy', false )"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm9"/>
        <transition on="false" to="datasetForm8"/>

    </action-state>
    <!--End form page 8-->
    <!--               -->

    <!-- Creators -->
    <!--Form page 9-->
    <view-state id="datasetForm9" model="flowScope.dataset">
        <transition on="previous" to="datasetForm8"/>
        <transition on="next" to="validateForm9"/>

        <transition on="index" to="index">
        <!--<transition on="index" to="validateForm9">-->
        <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm9">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext,'edu.pitt.isg.mdc.dats2_2.PersonComprisedEntity', 'getCreators', false )"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm10"/>
        <transition on="false" to="datasetForm9"/>

    </action-state>
    <!--End form page 9-->
    <!--               -->

    <!-- Licenses -->
    <!--Form page 10-->
    <view-state id="datasetForm10" model="flowScope.dataset">
        <transition on="previous" to="datasetForm9"/>
        <transition on="next" to="validateForm10"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm10">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext,'edu.pitt.isg.mdc.dats2_2.License', 'getLicenses', false )"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm11"/>
        <transition on="false" to="datasetForm10"/>

    </action-state>
    <!--End form page 10-->
    <!--               -->

    <!-- Is About -->
    <!--Form page 11-->
    <view-state id="datasetForm11" model="flowScope.dataset">
        <transition on="previous" to="datasetForm10"/>
        <transition on="next" to="validateForm11"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm11">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext,'edu.pitt.isg.mdc.dats2_2.IsAbout', 'getIsAbout', false )"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm12"/>
        <transition on="false" to="datasetForm11"/>

    </action-state>
    <!--End form page 11-->
    <!--               -->

    <!-- Acknowledges -->
    <!--Form page 12-->
    <view-state id="datasetForm12" model="flowScope.dataset">
        <transition on="previous" to="datasetForm11"/>
        <transition on="next" to="validateForm12"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm12">
        <evaluate expression="datasetWebflowValidator.validateDataset(flowScope.dataset, messageContext,'edu.pitt.isg.mdc.dats2_2.Grant', 'getAcknowledges', false )"/>
        <transition on="index" to="index"/>
        <transition on="true" to="datasetForm13"/>
        <transition on="false" to="datasetForm12"/>

    </action-state>
    <!--End form page 12-->
    <!--               -->

    <!-- Extra Properties -->
    <!--Form page 13-->
    <view-state id="datasetForm13" model="flowScope.dataset">
        <transition on="previous" to="datasetForm12"/>
        <transition on="submit" to="validateForm13"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </view-state>

    <action-state id="validateForm13">
        <evaluate expression="datasetWebflowValidator.createDataset(flowRequestContext)" />

        <transition on="true" to="entryConfirmation"/>
        <transition on="false" to="datasetForm13"/>

        <transition on="index" to="index">
            <set name="flowScope.indexValue" value="requestParameters.indexValue"/>
        </transition>
    </action-state>
    <!--End form page 13-->
    <!--               -->

   <end-state id="entryConfirmation"/>


</flow>